syntax = "proto3";

package gameap.plugin.sdk.storage;

import "pkg/proto/entity.proto";

option go_package = "github.com/gameap/gameap/pkg/plugin/sdk/storage";

// StorageService provides persistent storage capabilities to plugins
// go:plugin type=host module=gameap-storage
service StorageService {
  rpc Get(StorageGetRequest) returns (StorageGetResponse);
  rpc Set(StorageSetRequest) returns (StorageSetResponse);
  rpc Delete(StorageDeleteRequest) returns (StorageDeleteResponse);
  rpc List(StorageListRequest) returns (StorageListResponse);
}

message StorageGetRequest {
  string key = 1;
  optional gameap.EntityType entity_type = 2;
  optional uint64 entity_id = 3;
}

message StorageGetResponse {
  optional bytes payload = 1;
  bool found = 2;
}

message StorageSetRequest {
  string key = 1;
  optional gameap.EntityType entity_type = 2;
  optional uint64 entity_id = 3;
  bytes payload = 4;
}

message StorageSetResponse {
  bool success = 1;
  optional string error = 2;
}

message StorageDeleteRequest {
  string key = 1;
  optional gameap.EntityType entity_type = 2;
  optional uint64 entity_id = 3;
}

message StorageDeleteResponse {
  bool success = 1;
}

message StorageListRequest {
  optional string key_prefix = 1;
  optional gameap.EntityType entity_type = 2;
  optional uint64 entity_id = 3;
}

message StorageListResponse {
  repeated StorageEntry entries = 1;
}

message StorageEntry {
  string key = 1;
  optional gameap.EntityType entity_type = 2;
  optional uint64 entity_id = 3;
  bytes payload = 4;
}
